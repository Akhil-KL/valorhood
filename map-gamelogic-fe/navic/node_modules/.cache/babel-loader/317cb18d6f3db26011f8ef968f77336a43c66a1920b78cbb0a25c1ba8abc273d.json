{"ast":null,"code":"// src/components/PlayerMap.jsx\nimport React,{useEffect,useState,useRef}from\"react\";import{MapContainer,TileLayer,Marker,Circle,useMap}from\"react-leaflet\";import L from\"leaflet\";import\"leaflet/dist/leaflet.css\";import socket from\"../socket\";// ‚úÖ Make sure this is correctly configured\n// Fix Leaflet marker icons\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";delete L.Icon.Default.prototype._getIconUrl;L.Icon.Default.mergeOptions({iconRetinaUrl:\"https://unpkg.com/leaflet@1.9.3/dist/images/marker-icon-2x.png\",iconUrl:\"https://unpkg.com/leaflet@1.9.3/dist/images/marker-icon.png\",shadowUrl:\"https://unpkg.com/leaflet@1.9.3/dist/images/marker-shadow.png\"});// Component to recenter map when position changes\nconst RecenterMap=_ref=>{let{position}=_ref;const map=useMap();useEffect(()=>{if(position){map.setView(position);}},[position,map]);return null;};const PlayerMap=()=>{const[position,setPosition]=useState(null);const[playerPosition,setPlayerPosition]=useState(null);const[allPlayers,setAllPlayers]=useState({});const watchIdRef=useRef(null);useEffect(()=>{console.log(\"üìç Requesting location...\");if(!navigator.geolocation){alert(\"Geolocation is not supported by your browser.\");return;}watchIdRef.current=navigator.geolocation.watchPosition(pos=>{const{latitude,longitude}=pos.coords;const newPos=[latitude,longitude];console.log(\"üìå My position: \",newPos);setPosition(newPos);setPlayerPosition(newPos);socket.emit(\"updatePosition\",{lat:latitude,lng:longitude});},err=>{console.error(\"‚ùå Geolocation error:\",err);alert(`Geolocation error: ${err.message}`);},{enableHighAccuracy:true,timeout:20000,maximumAge:0});return()=>{if(watchIdRef.current!==null){navigator.geolocation.clearWatch(watchIdRef.current);}};},[]);useEffect(()=>{socket.on(\"connect_error\",err=>{console.error(\"‚ö†Ô∏è Connection error:\",err);});socket.on(\"playersUpdate\",players=>{setAllPlayers(players);});return()=>{socket.off(\"playersUpdate\");};},[]);return position&&playerPosition?/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(MapContainer,{center:position,zoom:18,minZoom:15,maxZoom:20,style:{height:\"80vh\",width:\"100%\"},children:[/*#__PURE__*/_jsx(TileLayer,{url:\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"}),/*#__PURE__*/_jsx(Marker,{position:playerPosition,icon:L.icon({iconUrl:\"https://maps.google.com/mapfiles/ms/icons/red-dot.png\",iconSize:[32,32],iconAnchor:[16,32]})}),Object.entries(allPlayers).map(_ref2=>{let[id,loc]=_ref2;if(loc.lat===playerPosition[0]&&loc.lng===playerPosition[1])return null;return/*#__PURE__*/_jsx(Marker,{position:[loc.lat,loc.lng],icon:L.icon({iconUrl:\"https://maps.google.com/mapfiles/ms/icons/blue-dot.png\",iconSize:[32,32],iconAnchor:[16,32]})},id);}),/*#__PURE__*/_jsx(Circle,{center:playerPosition,radius:100,color:\"blue\"}),/*#__PURE__*/_jsx(RecenterMap,{position:position})]})}):/*#__PURE__*/_jsxs(\"p\",{style:{padding:\"1rem\"},children:[\"\\uD83D\\uDCCD \",/*#__PURE__*/_jsx(\"strong\",{children:\"Loading location\\u2026\"}),\" Make sure location permissions are enabled.\"]});};export default PlayerMap;","map":{"version":3,"names":["React","useEffect","useState","useRef","MapContainer","TileLayer","Marker","Circle","useMap","L","socket","jsx","_jsx","jsxs","_jsxs","Icon","Default","prototype","_getIconUrl","mergeOptions","iconRetinaUrl","iconUrl","shadowUrl","RecenterMap","_ref","position","map","setView","PlayerMap","setPosition","playerPosition","setPlayerPosition","allPlayers","setAllPlayers","watchIdRef","console","log","navigator","geolocation","alert","current","watchPosition","pos","latitude","longitude","coords","newPos","emit","lat","lng","err","error","message","enableHighAccuracy","timeout","maximumAge","clearWatch","on","players","off","children","center","zoom","minZoom","maxZoom","style","height","width","url","icon","iconSize","iconAnchor","Object","entries","_ref2","id","loc","radius","color","padding"],"sources":["E:/navic/src/components/PlayerMap.jsx"],"sourcesContent":["// src/components/PlayerMap.jsx\r\n\r\nimport React, { useEffect, useState, useRef } from \"react\";\r\nimport { MapContainer, TileLayer, Marker, Circle, useMap } from \"react-leaflet\";\r\nimport L from \"leaflet\";\r\nimport \"leaflet/dist/leaflet.css\";\r\nimport socket from \"../socket\"; // ‚úÖ Make sure this is correctly configured\r\n\r\n// Fix Leaflet marker icons\r\ndelete L.Icon.Default.prototype._getIconUrl;\r\nL.Icon.Default.mergeOptions({\r\n  iconRetinaUrl: \"https://unpkg.com/leaflet@1.9.3/dist/images/marker-icon-2x.png\",\r\n  iconUrl: \"https://unpkg.com/leaflet@1.9.3/dist/images/marker-icon.png\",\r\n  shadowUrl: \"https://unpkg.com/leaflet@1.9.3/dist/images/marker-shadow.png\",\r\n});\r\n\r\n// Component to recenter map when position changes\r\nconst RecenterMap = ({ position }) => {\r\n  const map = useMap();\r\n  useEffect(() => {\r\n    if (position) {\r\n      map.setView(position);\r\n    }\r\n  }, [position, map]);\r\n  return null;\r\n};\r\n\r\nconst PlayerMap = () => {\r\n  const [position, setPosition] = useState(null);\r\n  const [playerPosition, setPlayerPosition] = useState(null);\r\n  const [allPlayers, setAllPlayers] = useState({});\r\n  const watchIdRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    console.log(\"üìç Requesting location...\");\r\n\r\n    if (!navigator.geolocation) {\r\n      alert(\"Geolocation is not supported by your browser.\");\r\n      return;\r\n    }\r\n\r\n    watchIdRef.current = navigator.geolocation.watchPosition(\r\n      (pos) => {\r\n        const { latitude, longitude } = pos.coords;\r\n        const newPos = [latitude, longitude];\r\n\r\n        console.log(\"üìå My position: \", newPos);\r\n\r\n        setPosition(newPos);\r\n        setPlayerPosition(newPos);\r\n\r\n        socket.emit(\"updatePosition\", { lat: latitude, lng: longitude });\r\n      },\r\n      (err) => {\r\n        console.error(\"‚ùå Geolocation error:\", err);\r\n        alert(`Geolocation error: ${err.message}`);\r\n      },\r\n      {\r\n        enableHighAccuracy: true,\r\n        timeout: 20000,\r\n        maximumAge: 0,\r\n      }\r\n    );\r\n\r\n    return () => {\r\n      if (watchIdRef.current !== null) {\r\n        navigator.geolocation.clearWatch(watchIdRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    socket.on(\"connect_error\", (err) => {\r\n      console.error(\"‚ö†Ô∏è Connection error:\", err);\r\n    });\r\n\r\n    socket.on(\"playersUpdate\", (players) => {\r\n      setAllPlayers(players);\r\n    });\r\n\r\n    return () => {\r\n      socket.off(\"playersUpdate\");\r\n    };\r\n  }, []);\r\n\r\n  return position && playerPosition ? (\r\n    <div>\r\n      <MapContainer\r\n        center={position}\r\n        zoom={18}\r\n        minZoom={15}\r\n        maxZoom={20}\r\n        style={{ height: \"80vh\", width: \"100%\" }}\r\n      >\r\n        <TileLayer url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\" />\r\n\r\n        {/* ‚úÖ Player marker (you) */}\r\n        <Marker\r\n          position={playerPosition}\r\n          icon={L.icon({\r\n            iconUrl: \"https://maps.google.com/mapfiles/ms/icons/red-dot.png\",\r\n            iconSize: [32, 32],\r\n            iconAnchor: [16, 32],\r\n          })}\r\n        />\r\n\r\n        {/* ‚úÖ Other players */}\r\n        {Object.entries(allPlayers).map(([id, loc]) => {\r\n          if (loc.lat === playerPosition[0] && loc.lng === playerPosition[1]) return null;\r\n\r\n          return (\r\n            <Marker\r\n              key={id}\r\n              position={[loc.lat, loc.lng]}\r\n              icon={L.icon({\r\n                iconUrl: \"https://maps.google.com/mapfiles/ms/icons/blue-dot.png\",\r\n                iconSize: [32, 32],\r\n                iconAnchor: [16, 32],\r\n              })}\r\n            />\r\n          );\r\n        })}\r\n\r\n        {/* ‚úÖ Boundary circle */}\r\n        <Circle center={playerPosition} radius={100} color=\"blue\" />\r\n\r\n        {/* ‚úÖ Auto center map */}\r\n        <RecenterMap position={position} />\r\n      </MapContainer>\r\n    </div>\r\n  ) : (\r\n    <p style={{ padding: \"1rem\" }}>\r\n      üìç <strong>Loading location‚Ä¶</strong> Make sure location permissions are enabled.\r\n    </p>\r\n  );\r\n};\r\n\r\nexport default PlayerMap;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}